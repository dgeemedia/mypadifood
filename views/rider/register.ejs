<!-- views/rider/register.ejs -->
<div class="account-page">
  <h1 class="account-title">Register as a Rider</h1>

  <div class="flash-messages"><%- messages() %></div>

  <% if (errors && errors.length) { %>
  <ul class="form-errors" role="alert">
    <% errors.forEach(err => { %>
      <li><%= err.msg || err %></li>
    <% }) %>
  </ul>
  <% } %>

  <form method="post" action="/rider/register" id="rider-form" class="account-form"
        novalidate enctype="multipart/form-data">

    <div class="form-row">
      <label for="rider-fullname">Full name <span class="required">*</span></label>
      <input id="rider-fullname" name="full_name" type="text" required
             value="<%= (locals && locals.full_name) ? locals.full_name : '' %>" />
    </div>

    <div class="form-row">
      <label for="rider-email">Email <span class="required">*</span></label>
      <input id="rider-email" name="email" type="email" required
             value="<%= (locals && locals.email) ? locals.email : '' %>" />
    </div>

    <div class="form-row">
      <label for="rider-phone">Phone <span class="required">*</span></label>
      <input id="rider-phone" name="phone" type="text" required
             value="<%= (locals && locals.phone) ? locals.phone : '' %>" />
    </div>

    <div class="form-row">
      <label for="rider-state">State <span class="required">*</span></label>
      <select id="rider-state" name="state" required>
        <option value="">Select state</option>
        <% if (Array.isArray(statesLGAs)) statesLGAs.forEach(s => { %>
          <% if (locals && locals.state === s.state) { %>
            <option value="<%= s.state %>" selected><%= s.state %></option>
          <% } else { %>
            <option value="<%= s.state %>"><%= s.state %></option>
          <% } %>
        <% }) %>
      </select>
    </div>

    <div class="form-row">
      <label for="rider-lga">LGA <span class="required">*</span></label>
      <select id="rider-lga" name="lga" data-selected="<%= (locals && locals.lga) ? locals.lga : '' %>" required>
        <option value="">Select LGA</option>
      </select>
    </div>

    <div class="form-row">
      <label for="rider-address">Address <span class="required">*</span></label>
      <input id="rider-address" name="address" type="text" required
             value="<%= (locals && locals.address) ? locals.address : '' %>" />
    </div>

    <div class="form-row">
      <label for="vehicle_type">Vehicle type <span class="required">*</span></label>
      <select id="vehicle_type" name="vehicle_type" required>
        <option value="">Select</option>
        <option value="motorcycle" <%= locals && locals.vehicle_type==='motorcycle' ? 'selected' : '' %>>Motorcycle</option>
        <option value="car" <%= locals && locals.vehicle_type==='car' ? 'selected' : '' %>>Car</option>
        <option value="bicycle" <%= locals && locals.vehicle_type==='bicycle' ? 'selected' : '' %>>Bicycle</option>
      </select>
    </div>

    <div class="form-row">
      <label for="vehicle_number">Vehicle number <span class="required">*</span></label>
      <input id="vehicle_number" name="vehicle_number" type="text" required
             value="<%= (locals && locals.vehicle_number) ? locals.vehicle_number : '' %>" />
    </div>

    <div class="form-row">
      <label for="bank_name">Bank name <span class="required">*</span></label>
      <input id="bank_name" name="bank_name" type="text" required
             value="<%= (locals && locals.bank_name) ? locals.bank_name : '' %>" />
    </div>

    <div class="form-row">
      <label for="account_number">Account number <span class="required">*</span></label>
      <input id="account_number" name="account_number" type="text" required
             value="<%= (locals && locals.account_number) ? locals.account_number : '' %>" />
    </div>

    <div class="form-row">
      <label for="rider-id-type">ID type <span class="required">*</span></label>
      <select id="rider-id-type" name="id_type" required>
        <option value="">Select ID</option>
        <option value="national_id" <%= locals && locals.id_type==='national_id' ? 'selected' : '' %>>National ID</option>
        <option value="driver_license" <%= locals && locals.id_type==='driver_license' ? 'selected' : '' %>>Driver's License</option>
        <option value="nin" <%= locals && locals.id_type==='nin' ? 'selected' : '' %>>NIN</option>
        <option value="international_passport" <%= locals && locals.id_type==='international_passport' ? 'selected' : '' %>>International Passport</option>
      </select>
    </div>

    <div class="form-row">
      <label for="rider-id-number">ID number <span class="required">*</span></label>
      <input id="rider-id-number" name="id_number" type="text" required
             value="<%= (locals && locals.id_number) ? locals.id_number : '' %>" />
    </div>

    <div class="form-row">
      <label for="rider-next-of-kin">Next of kin (name and phone)</label>
      <input id="rider-next-of-kin" name="next_of_kin" type="text"
             value="<%= (locals && locals.next_of_kin) ? locals.next_of_kin : '' %>" />
    </div>

    <div class="form-row">
      <label for="rider-base-fee">Base delivery fee (optional)</label>
      <input id="rider-base-fee" name="base_fee" type="number" step="0.01" min="0"
             value="<%= (locals && (locals.base_fee || locals.base_fee === 0)) ? locals.base_fee : '' %>" />
    </div>

    <div class="form-row">
      <label for="rider-id-file">ID image (optional)</label>
      <input id="rider-id-file" name="id_file" type="file" accept="image/*" />
    </div>

    <div class="form-row">
      <label for="rider-password">Password <span class="required">*</span></label>
      <input id="rider-password" name="password" type="password" required />
    </div>

    <input type="hidden" id="rider-latitude" name="latitude" value="<%= (locals && locals.latitude) ? locals.latitude : '' %>">
    <input type="hidden" id="rider-longitude" name="longitude" value="<%= (locals && locals.longitude) ? locals.longitude : '' %>">
    <input type="hidden" id="rider-location-source" name="location_source" value="<%= (locals && locals.location_source) ? locals.location_source : 'manual' %>">

    <div class="form-row">
      <button type="button" id="rider-use-location" class="btn secondary">Use my device location</button>
      <div class="muted-note">You can also fill state/LGA manually</div>
    </div>

    <div class="form-row" style="margin-top:6px">
      <div class="muted-note">By clicking submit you accept the terms.</div>
    </div>

    <div class="form-row">
      <button type="submit" class="btn-primary">Submit rider application</button>
    </div>
  </form>

  <p class="register-link" style="width:100%;max-width:460px">Returning user? <a href="/">Go back to home</a></p>

  <!-- States data for location-picker -->
  <div id="states-data" data-states="<%- JSON.stringify(statesLGAs || []) %>" style="display:none" aria-hidden="true"></div>
  <script>window.STATE_DATA = <%- JSON.stringify(statesLGAs || []) %>;</script>
</div>
