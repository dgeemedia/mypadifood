<!-- views/vendor/register.ejs -->
<div class="account-page">
  <h1 class="account-title">Register as a Vendor</h1>

  <!-- Flash messages -->
  <div class="flash-messages"><%- messages() %></div>

  <% if (errors && errors.length) { %>
  <ul class="form-errors" role="alert">
    <% errors.forEach(err => { %>
    <li><%= err.msg || err %></li>
    <% }) %>
  </ul>
  <% } %>

  <form
    method="post"
    action="/vendor/register"
    id="vendor-form"
    class="account-form"
    novalidate
  >
    <div class="form-row">
      <label for="vendor-name"
        >Vendor / Stall name
        <span class="required" aria-hidden="true">*</span></label
      >
      <input
        id="vendor-name"
        name="name"
        type="text"
        required
        value="<%= (locals && locals.name) ? locals.name : '' %>"
      />
    </div>

    <div class="form-row">
      <label for="vendor-state"
        >State <span class="required" aria-hidden="true">*</span></label
      >
      <select id="vendor-state" name="state" required>
        <option value="">Select state</option>
        <% if (Array.isArray(statesLGAs)) { %>
        <% statesLGAs.forEach(s => { %>
        <% if (locals && locals.state === s.state) { %>
        <option value="<%= s.state %>" selected><%= s.state %></option>
        <% } else { %>
        <option value="<%= s.state %>"><%= s.state %></option>
        <% } %>
        <% }) %>
        <% } %>
      </select>
    </div>

    <div class="form-row">
      <label for="vendor-lga"
        >LGA <span class="required" aria-hidden="true">*</span></label
      >
      <select
        id="vendor-lga"
        name="lga"
        data-selected="<%= (locals && locals.lga) ? locals.lga : '' %>"
        required
      >
        <option value="">Select LGA</option>
      </select>
    </div>

    <div class="form-row">
      <label for="vendor-address"
        >Exact address <span class="required" aria-hidden="true">*</span></label
      >
      <input
        id="vendor-address"
        name="address"
        type="text"
        required
        value="<%= (locals && locals.address) ? locals.address : '' %>"
      />
    </div>

    <div class="form-row">
      <label for="vendor-phone"
        >Phone <span class="required" aria-hidden="true">*</span></label
      >
      <input
        id="vendor-phone"
        name="phone"
        type="text"
        required
        value="<%= (locals && locals.phone) ? locals.phone : '' %>"
      />
    </div>

    <div class="form-row">
      <label for="vendor-email"
        >Email <span class="required" aria-hidden="true">*</span></label
      >
      <input
        id="vendor-email"
        name="email"
        type="email"
        required
        value="<%= (locals && locals.email) ? locals.email : '' %>"
      />
    </div>

    <div class="form-row">
      <label for="vendor-food-item"
        >Food items (comma separated)
        <span class="required" aria-hidden="true">*</span></label
      >
      <textarea id="vendor-food-item" name="food_item" required>
<%= (locals && locals.food_item) ? locals.food_item : '' %></textarea
      >
    </div>

    <div class="form-row">
      <label for="vendor-base-price"
        >Base price (per plate)
        <span class="required" aria-hidden="true">*</span></label
      >
      <input
        id="vendor-base-price"
        name="base_price"
        type="number"
        step="0.01"
        min="0"
        required
        value="<%= (locals && locals.base_price) ? locals.base_price : '' %>"
      />
    </div>

    <input
      type="hidden"
      name="latitude"
      id="vendor-latitude"
      value="<%= (locals && locals.latitude) ? locals.latitude : '' %>"
    />
    <input
      type="hidden"
      name="longitude"
      id="vendor-longitude"
      value="<%= (locals && locals.longitude) ? locals.longitude : '' %>"
    />
    <input
      type="hidden"
      name="location_source"
      id="vendor-location-source"
      value="<%= (locals && locals.location_source) ? locals.location_source : 'manual' %>"
    />

    <div class="form-row">
      <button type="button" id="vendor-use-location" class="btn secondary">
        Use my device location
      </button>
      <div class="muted-note">You can also fill state/LGA manually</div>
    </div>

    <div class="form-row" style="margin-top: 6px">
      <div class="muted-note">By clicking submit you accept the terms.</div>
    </div>

    <div class="form-row">
      <button type="submit" class="btn-primary">
        Submit vendor application
      </button>
    </div>
  </form>

  <p
    class="register-link"
    style="width: 100%; max-width: 460px; text-align: center"
  >
    Returning user? <a href="/">Go back to home</a>
  </p>

  <!-- Server-provided states data (used by location-picker.js) -->
  <div
    id="states-data"
    data-states="<%- JSON.stringify(statesLGAs || []) %>"
    style="display: none"
    aria-hidden="true"
  ></div>
</div>
<script>
  // Expose statesLGAs as a JS object so location-picker doesn't need to parse attributes.
  window.STATE_DATA = <%- JSON.stringify(statesLGAs || []) %>;
</script>
