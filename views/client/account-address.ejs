<!-- views/client/account-address.ejs -->
<h2>Edit address</h2>

<div id="address-form-result" role="status" aria-live="polite"></div>

<form id="addressForm" class="account-edit-form" novalidate>
  <div class="form-row">
    <label for="client-state">State</label>
    <select id="client-state" name="state" required>
      <option value="">Select state</option>
      <% if (Array.isArray(statesLGAs) && statesLGAs.length) { %>
      <% statesLGAs.forEach(s => { %>
      <% if (currentUser && String(currentUser.state || '') === String(s.state)) { %>
      <option value="<%= s.state %>" selected><%= s.state %></option>
      <% } else { %>
      <option value="<%= s.state %>"><%= s.state %></option>
      <% } %>
      <% }) %>
      <% } %>
    </select>
  </div>

  <div class="form-row">
    <label for="client-lga">LGA</label>
    <select id="client-lga" name="lga" required>
      <option value="">Select LGA</option>
      <% if (currentUser && currentUser.lga) { %>
      <!-- include current LGA as an initial value; location-picker will repopulate and try to restore this selection -->
      <option value="<%= currentUser.lga %>" selected>
        <%= currentUser.lga %>
      </option>
      <% } %>
    </select>
  </div>

  <div class="form-row">
    <label for="address">Address</label>
    <input
      id="address"
      name="address"
      type="text"
      value="<%= currentUser ? currentUser.address : '' %>"
      required
    />
  </div>

  <div class="form-row">
    <button type="submit" class="btn-primary">Save address</button>
    <a href="/client/dashboard" class="btn">Return to dashboard</a>
  </div>
</form>

<!-- Server-provided states data for location-picker.js -->
<div
  id="states-data"
  data-states="<%- JSON.stringify(statesLGAs || []) %>"
  style="display: none"
  aria-hidden="true"
></div>

<!-- Note: this view relies on public/js/location-picker.js (already included in your layout) to populate LGAs when a state is selected. -->
<script>
  // Expose statesLGAs as a JS object so location-picker doesn't need to parse attributes.
  window.STATE_DATA = <%- JSON.stringify(statesLGAs || []) %>;
</script>
