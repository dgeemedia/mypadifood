<!--views/client/dashboard.ejs-->
<h2>
  Welcome,
  <%= currentUser ? currentUser.name : 'Client' %>
</h2>

<section>
  <h3>Your Orders</h3>
  <% if (!orders || !orders.length) { %>
  <p>No orders yet.</p>
  <% } else { %>
  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>Vendor</th>
        <th>Status</th>
        <th>Amount</th>
        <th>Chat</th>
      </tr>
    </thead>
    <tbody>
      <% orders.forEach(o => { %>
      <tr>
        <td><%= o.item %></td>
        <td><%= o.vendor_name ? o.vendor_name : o.vendor_id %></td>
        <td><%= o.status %></td>
        <td>₦<%= o.total_amount %></td>
        <td>
          <button class="btn btn-view-chat" data-order-id="<%= o.id %>">
            View Chat
          </button>
          <button class="btn btn-add-menu" data-order-id="<%= o.id %>">
            Add / Update Menu
          </button>
        </td>
      </tr>
      <% }) %>
    </tbody>
  </table>
  <% } %>
</section>

<%- include('../partials/chat-modal') %>

<section>
  <h3>Local Vendors</h3>
  <% if (!vendors || !vendors.length) { %>
  <p>No local vendors available.</p>
  <% } else { %>
  <% vendors.forEach(v => { %>
  <div class="vendor">
    <h4>
      <%= v.name %>
      - ₦<%= v.base_price %>
    </h4>
    <p><%= v.food_item %></p>
    <form method="post" action="/client/book">
      <input type="hidden" name="vendorId" value="<%= v.id %>" />
      <input type="text" name="item" placeholder="Special request" />
      <select name="payment_method">
        <option value="cod">Pay on delivery</option>
        <option value="paystack">Pay online (Paystack)</option>
        <option value="flutterwave">Pay online (Flutterwave)</option>
      </select>
      <button type="submit" class="btn">Book</button>
    </form>
  </div>
  <% }) %>
  <% } %>
</section>

<script>
  <% if (typeof recentOrderId !== 'undefined' && recentOrderId) { %>
    window.ORDER_ID = "<%= recentOrderId %>";
    // open chat automatically after DOM ready (chat.js supports window.ORDER_ID)
  <% } %>
</script>
