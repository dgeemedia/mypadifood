<!--views/admin/riders-pending.ejs-->
<h2>Pending Rider Applications</h2>

<div class="flash-messages"><%- messages() %></div>

<% if (!riders || !riders.length) { %>
  <p>No pending rider applications.</p>
<% } else { %>
  <table class="resources-table" role="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Contact</th>
        <th>State / LGA</th>
        <th>Details</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <% riders.forEach(r => { %>
        <tr id="rider-<%= r.id %>">
          <td><strong><%= r.full_name %></strong></td>
          <td><div><%= r.phone %></div><div class="muted small"><%= r.email %></div></td>
          <td><%= r.state %> / <%= r.lga %></td>
          <td>
            <div>Address: <%= r.address || '—' %></div>
            <div>Vehicle: <%= r.vehicle_type || '—' %></div>
            <div>Vehicle no: <%= r.vehicle_number || '—' %></div>
            <div>Bank: <%= r.bank_name || '—' %> • <%= r.account_number || '—' %></div>
            <% if (r.id_file) { %>
              <div><a href="/<%= r.id_file %>" target="_blank" rel="noopener">View ID</a></div>
            <% } %>
          </td>
          <td>
            <!-- JS-first buttons (AJAX). data-rider-id used by the client JS -->
            <div style="display:flex;flex-direction:column;gap:6px;">
              <button type="button" class="btn btn-primary" data-action="approve" data-rider-id="<%= r.id %>">Approve</button>

              <div style="display:flex;gap:6px;align-items:center;">
                <input type="text" name="reason" placeholder="Optional reason" style="flex:1;padding:6px;font-size:0.9em" />
                <button type="button" class="btn btn-danger" data-action="reject" data-rider-id="<%= r.id %>">Reject</button>
              </div>
            </div>

            <!-- Non-JS fallback: keep classic forms but hide visually (for browsers without JS) -->
            <noscript>
              <form method="post" action="/admin/resources/riders/decision" style="display:block;margin-top:6px">
                <input type="hidden" name="riderId" value="<%= r.id %>">
                <input type="hidden" name="decision" value="approve">
                <button type="submit" class="btn btn-primary">Approve</button>
              </form>

              <form method="post" action="/admin/resources/riders/decision" style="display:block;margin-top:6px;">
                <input type="hidden" name="riderId" value="<%= r.id %>">
                <input type="hidden" name="decision" value="reject">
                <input type="text" name="reason" placeholder="Optional reason" />
                <button type="submit" class="btn btn-danger">Reject</button>
              </form>
            </noscript>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
<% } %>

<!-- include the new client-side handler -->
<script src="/js/admin-riders-pending.js"></script>
