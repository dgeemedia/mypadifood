<% /* views/admin/withdrawals-list.ejs */ %>
<% layout('admin/layout') %>

<h1>Withdrawal requests</h1>

<p>
  Review pending withdrawal requests. Click Approve to debit the client wallet (or mark paid later),
  or Decline to reject the request. Use the Provider Reference when you've performed an external payout.
</p>

<% if (flash && flash.error) { %>
  <div class="alert alert-danger"><%= flash.error %></div>
<% } %>
<% if (flash && flash.success) { %>
  <div class="alert alert-success"><%= flash.success %></div>
<% } %>

<table id="withdrawals-table" class="table">
  <thead>
    <tr>
      <th>Client</th>
      <th>Amount (₦)</th>
      <th>Destination</th>
      <th>Requested</th>
      <th>Notes</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% if (!withdrawals || !withdrawals.length) { %>
      <tr><td colspan="6">No pending withdrawal requests.</td></tr>
    <% } else { %>
      <% withdrawals.forEach(w => { %>
        <tr data-id="<%= w.id %>">
          <td>
            <strong><%= w.client_name || (w.client && w.client.full_name) || 'Client' %></strong>
            <div class="muted"><%= w.client_email || (w.client && w.client.email) || '' %> • <%= w.client_phone || (w.client && w.client.phone) || '' %></div>
          </td>
          <td><%= Number(w.amount).toFixed(2) %></td>
          <td>
            <% if (w.destination && typeof w.destination === 'object') { %>
              <div><strong>Bank:</strong> <%= w.destination.bank || '' %></div>
              <div><strong>Acct:</strong> <%= w.destination.account_number || '' %> (<%= w.destination.account_name || '' %>)</div>
            <% } else { %>
              <%= w.destination || '—' %>
            <% } %>
          </td>
          <td><%= w.created_at ? new Date(w.created_at).toLocaleString() : '—' %></td>
          <td><%= w.admin_note || w.note || '' %></td>
          <td>
            <button class="btn btn-sm btn-primary btn-approve" data-id="<%= w.id %>">Approve</button>
            <button class="btn btn-sm btn-danger btn-decline" data-id="<%= w.id %>">Decline</button>
            <a href="/admin/withdrawals/<%= w.id %>" class="btn btn-sm btn-link">View</a>
          </td>
        </tr>
      <% }) %>
    <% } %>
  </tbody>
</table>

<!-- Approve modal and Decline modal markup (same as you already provided) -->
<%- include('admin/partials/withdrawal-modals') %>

<link rel="stylesheet" href="/css/admin.css">

<script src="/js/admin-withdrawals.js" defer></script>
